---
title: "HW 06 Part 2: Wrangling"
author: "Madison Hongsermeier-Baxter"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r}
library(tidyverse)
library(knitr)
install.packages("smatr")
library(smatr)
```

# darters

```{r}
file_path <- "~/Documents/BI485/hongsermeier-baxter_madison/data"
dat <- read.delim(file.path(file_path, "darters.txt"))
```

```{r}
start_pos <- c(1, 4, 15, 16, 17, 18, 21, 25, 29, 33, 36, 39, 40)
stop_pos <- c(3, 14, 15, 16, 17, 20, 24, 28, 32, 35, 38, 40, 41)
names <- c("specimen id", "species", "riffle", "age", "sex", "length", "depth", "velocity", "temperature", "majsub", "minsub", "majtype", "mintype")
darters <- read_fwf(file.path(file_path, "darters.txt"), fwf_positions(start_pos, stop_pos, col_names = names), skip = 15)
```

```{r}
darters
```

Use filter() to remove tetrazonum and zonale.

```{r}
darters2 <- darters %>%
  filter(!species %in% c("zonale", "tetrazonum"))
darters2
```

Sum together the majsub and minsub into a new column called total_substrate. Does total_substrate sum to 1 for all observations?

Yes, total_substrate sums to 1 for all observations.
```{r}
mutate(darters2,
  total_substrate = majsub + minsub
)
```

Change the riffle values of 1 and 2 to Riffle 1 and Riffle 2.
```{r}
darters2$riffle[darters2$riffle==1] <- "Riffle_1"
darters2$riffle[darters2$riffle==2] <- "Riffle_2"
darters2
```

Change the length data from centimeters to millimeters. It is more common to use mm for small fishes.
```{r}
darters2 <- mutate(darters2,
       length = length * 10)
```

```{r}
darters2
```

Change the sex values of f and m to Female and Male.
```{r}
darters2$sex[darters2$sex=="f"] <- "Female"
darters2$sex[darters2$sex=="m"] <- "Male"
darters2
```

Use group_by() and summarize() to summarize the mean length, depth, and velocity for each species for each riffle. Make a table with the summary means.

```{r}
darters_means <- darters2 %>% group_by(species) %>%
  summarise_at(.vars = vars(length, depth, velocity), 
               .funs = c(mean = "mean")) 
darters_means
```

Plot 1
Make a plot that uses the stat_summary() technique but use x = species and y = length. Add a geom_point() layer to add the mean length of each species to the plot. Use a filled square shape. You will have to use the summarized data set to get the mean for this geom.

```{r}
ggplot(data = darters2) +
  stat_summary(
    mapping = aes(x = species, y = length),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  ) +
  geom_point(data=darters_means, mapping = aes(x = species, y = length_mean), shape = 15)
```

Turn the plot so that the species are listed on the left axis and length on bottom axis
```{r}
ggplot(data = darters2) +
  stat_summary(
    mapping = aes(x = species, y = length),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  ) +
  geom_point(data=darters_means, mapping = aes(x = species, y = length_mean), shape = 15) +
  coord_flip()
```

Add facet_wrap() to separate the two riffles.
```{r}
ggplot(data = darters2) +
  stat_summary(
    mapping = aes(x = species, y = length),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  ) +
  geom_point(data=darters_means, mapping = aes(x = species, y = length_mean), shape = 15) +
  coord_flip() +
  facet_wrap(~ riffle, nrow = 2)
```

Add labs() so that length includes the appropriate unit of measurement in parentheses and that the species axis is not labeled (x = NULL).
```{r}
ggplot(data = darters2) +
  stat_summary(
    mapping = aes(x = species, y = length),
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median
  ) +
  geom_point(data=darters_means, mapping = aes(x = species, y = length_mean), shape = 15) +
  coord_flip() +
  facet_wrap(~ riffle, nrow = 2) +
  labs(y = "Length (mm)", x = "Species")
```

How does the relationship of the median, mean, and range change between the two riffles? In other words, how does the size distribution change between the two riffles?

"Spectabile" has a similar range in both riffles, but a lower median in riffle 2. "Caeruleum" has a smaller range and lower median in riffle 2. "Blennioides" has a much larger range in riffle 2 and a slightly lower median. The mean is similar between rifles for all species.



Plot 2

Make a new plot with a geom_point() layer of length for each species
```{r}
ggplot(data = darters2, mapping = aes(x = species, y = length)) + 
  geom_point()
```

Change the point color to a lighter shade in the range of gray50 to gray70
```{r}
ggplot(data = darters2, mapping = aes(x = species, y = length)) + 
  geom_point(color = "gray50")
```

Add a stat_summary() layer with these arguments:
        fun.y = median
        geom = "point"
        size = 2.2
```{r}
ggplot(data = darters2, mapping = aes(x = species, y = length)) + 
  geom_point(color = "gray50") +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median,
    geom = "point",
    size = 2.2
  ) 
```

 Add another stat_summary(). Change the y function to mean, size to 3, and add the color = "15"maroon" argument.
```{r}
ggplot(data = darters2, mapping = aes(x = species, y = length)) + 
  geom_point(color = "gray50") +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median,
    geom = "point",
    size = 2.2
  ) +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = mean,
    size = 3,
    geom = "point",
    color = "maroon"
  )
```
 
Facet, label, and flip the graph as you did above
```{r}
ggplot(data = darters2, mapping = aes(x = species, y = length)) + 
  geom_point(color = "gray50") +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = median,
    geom = "point",
    size = 2.2
  ) +
  stat_summary(
    fun.ymin = min,
    fun.ymax = max,
    fun.y = mean,
    size = 3,
    geom = "point",
    color = "maroon"
  ) +
  coord_flip() +
  facet_wrap(~ riffle, nrow = 2) +
  labs(y = "Length (mm)", x = "Species")
```

# feathers



Use the locale = locale(<argument>) argument in the read_csv() function to specify the decimal mark.
```{r}
names <- c("capture_date", "day", "site", "urban_score", "cortF", "cortB", "sex", "smi", "tarsus", "mass", "basal_cort", "stress_cort")
file_path <- "~/Documents/BI485/hongsermeier-baxter_madison/data"
feathers <- read_csv(file.path(file_path, "feathers.csv"), locale = locale(decimal_mark = "."), skip = 1, col_names = names)
```

```{r}
feathers
```




Wrangle data

The authors use an index called the “scaled mass index” (SMI), included as a column. However, you will use R to recreate that value. The equation to calculate SMI for each individual (i

) is,

SMIi=Mi×(L0/Li)b,

where L0
is the mean tarsus length of all birds in the sample, Mi and Li are the mass and tarsus1 length of each individual, and b

is the slope estimate of the standardized major axis regression on the log-transformed mass and log-transformed tarsus length.

Fortunately, you do not need to know the details of the analysis. You can get the values you need with a few easy steps. Let’s first get b,

the slope of the regression.

    Calculate the mean tarsus length of all individuals in the data set, and store it in av ariable called mean_tarsus. You should know how to calculate the mean of all values in a column.
    Use mutate() to log-transform (log()) the body mass (mass) and the tarsus length (tarsus). Save these in new columns as log_mass and log_tarsus, respectively.
    Run the following function major_axis <- sma(log_mass ~ log_tarsus, data = <data>). Substitute the name of your imported data for <data>. The sma() function calculates the standardized major axis regression.
    Apply the summary() funciton to major_axis.
        The value you want for b

        is the slope of the estimate.
    Apply the coef() function to major_axis. The output is a named numeric vector with two elements. The value you want is the second element. Store that value in the variable b.

At this point, you now have the information you need to calculate “SMI” for each bird. L0
= mean_tarsus, b = b, and Mi and Li

are the mass and tarsus columns. Note: Do not use the log-transformed values for this calculation.

    Use mutate to calculate SMI and store the values in a new column called new_smi. Compare your new column with the column you imported. Your values should be nearly identical, differing by no more than 0.1. Hint (optional): Use the select() function of dplyr to rearrange your columns so that smi and new_smi are side by side. Or, print them out together. Note: If your numbers are not correct, figure out where you made a mistake and correct it.

Summarie data

Next, summarize the basal and stress corticosterone data.

    Group by site, and calculate the mean and standard error of the mean (SEY)

    for basal_cort and stress_cort. Standard error of the mean is calculated as,

SEY=sn‾√,

where s
is the standard deviation and n

is the number of individuals. You can calculate the standard deviation in R with the sd() function. Do not forgot to include na.rm = TRUE in the arguments for mean() and sd(), as shown in the text.
Graph data

Plot 1

    Make a boxplot of new_smi for each site. Do you see any clear differences among the four sites?

Plot 2 A common graph is to plot the means with error bars based on the standard errors of the means.

    Make a plot of the basal corticosterone concentration (ng/ml) for each site. Use geom_point(). Add a geom_errorbar() layer. Use the ? function and the interwebs if you need, but here are a few hints:
        x should be the sites,
        geom_errorbar() needs ymin and ymax to draw the lower and upper ends of the error bars. Here, ymin should be one standard error below the mean and ymax should be one standard error above the mean. How could you do that? Good. Now do it.

Plot 3

I am not a fan of the Star Wars Tie Fighter look of the default error bars. The horizontal lines do not add any information about the data. In other words, they decrease the data-ink ratio.

Repeat the above plot but with two differences. Use the mean_stress and its standard error, and use geom_linerange() instead of geom_errorbar. Linerange and errorbar use the same arguments.
Graduate and Honors students

You must modify one of the above graphs with the following requirements:

    use size of 3 for the point located at the mean,
    color the point maroon,
    place the error bars behind the points so that a black line does not cur across the face of each point.
    Assume you like the Tie Fighter look but you do not want them so exaggerated. Size them to something much smaller but still present. The exact size depends on your tastes. Note: I encourage undergrads to attempt this but this does not count for or against your grade.

et Vóila

    The tarsus looks like part of the bird’s leg but is homologous to the tarsal bones in the vertebrate foot.↩


